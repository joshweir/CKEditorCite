<!DOCTYPE html>
<html>
  <head>
    <title>Mocha Tests</title>
    <link rel="stylesheet" href="node_modules/mocha/mocha.css">
  </head>
  <body>
    <div id="mocha"></div>
    <script src="node_modules/mocha/mocha.js"></script>
    <script src="node_modules/chai/chai.js"></script>
	<script>mocha.setup('bdd');</script>
	<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="ckeditor/ckeditor.js"></script>
	<script src="ckeditor/samples/js/sample.js"></script>
    <link rel="stylesheet" href="ckeditor/samples/toolbarconfigurator/lib/codemirror/neo.css">
    <div>
		<form class="insert-citation">
			<div>
				<label style="display: inline-block; width: 200px;">Inline Citation (optional): </label>
				<input style="width:50%;" name="inline-citation" class="inline-citation" placeholder="(Johnston et al. [!a!]2009[/!a!])" value="(Johnston et al. [!a!]2009[/!a!])">
			</div>
			<div>
				<label style="display: inline-block; width: 200px;">Citation: </label>
				<input style="width:50%;" name="citation" class="citation" 
					placeholder="Johnston, E. L., Piola, R. F., &amp; Clark, G. F. (2009). The role of propagule pressure in invasion success. In &lt;i&gt;Biological invasions in marine ecosystems&lt;/i&gt; (pp. 133-151). Springer Berlin Heidelberg."
					value="Johnston, E. L., Piola, R. F., &amp; Clark, G. F. (2009). The role of propagule pressure in invasion success. In &lt;i&gt;Biological invasions in marine ecosystems&lt;/i&gt; (pp. 133-151). Springer Berlin Heidelberg.">
			<div>
			<input type="submit" value="Insert Citation at Cursor">
		</form>
		<div style="color: red;" class="validation-message"></div>
	</div>
    <div id="ckeditor-container">
		<textarea class="form-control" name="doc"></textarea>
	</div>
    <script>
		;(function(global){
			var editorElem = document.getElementById("ckeditor-container");
			var editor = CKEDITOR.replace("doc");
			global.editor = editor;
		})(this);
    </script>
	<script src="ckeditor/plugins/cite/tests/plugin-spec.js"></script>
	<script>
		CKEDITOR.on( 'instanceReady', function( evt ) {
			mocha.run();
		});
		$(document).ready(function(){
			var citeplugin = CKEDITOR.instances.doc.plugins.cite;
			$('.validation-message').text('');
			$('form.insert-citation').on('submit', function(evt) {
				evt.preventDefault();
				$('.validation-message').text('');
				if (!citeplugin.isValidHtml($('input[name=citation]').val()))
					$('.validation-message').text('Citation is not valid html.');
				else if (!citeplugin.isValidHtml($('input[name=inline-citation]').val()))
					$('.validation-message').text('In-text Citation is not valid html.');
				else 
					citeplugin.insert(
						$('input[name=citation]').val(), 
						CKEDITOR.instances.doc, 
						$('input[name=inline-citation]').val());
			});
		});
	</script>

  </body>
</html>
