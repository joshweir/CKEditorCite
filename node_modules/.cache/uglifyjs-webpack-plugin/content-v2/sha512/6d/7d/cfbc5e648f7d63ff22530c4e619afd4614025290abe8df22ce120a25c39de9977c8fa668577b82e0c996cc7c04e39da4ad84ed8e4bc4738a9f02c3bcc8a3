{"code":"!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,\"a\",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p=\"\",n(n.s=0)}([function(t,e,n){\"use strict\";function i(t){return null!=t&&\"object\"==typeof t&&!0===t[\"@@functional/placeholder\"]}function o(t){return function e(n){return 0===arguments.length||i(n)?e:t.apply(this,arguments)}}n.r(e);function r(t){return function e(n,r){switch(arguments.length){case 0:return e;case 1:return i(n)?e:o(function(e){return t(n,e)});default:return i(n)&&i(r)?e:i(n)?o(function(e){return t(e,r)}):i(r)?o(function(e){return t(n,e)}):t(n,r)}}}var a=Array.isArray||function(t){return null!=t&&t.length>=0&&\"[object Array]\"===Object.prototype.toString.call(t)};function s(t){return\"[object String]\"===Object.prototype.toString.call(t)}var u=o(function(t){return!!a(t)||!!t&&(\"object\"==typeof t&&(!s(t)&&(1===t.nodeType?!!t.length:0===t.length||t.length>0&&(t.hasOwnProperty(0)&&t.hasOwnProperty(t.length-1)))))});\"undefined\"!=typeof Symbol&&Symbol.iterator;function d(t,e){return Object.prototype.hasOwnProperty.call(e,t)}var c=Object.prototype.toString,l=function(){return\"[object Arguments]\"===c.call(arguments)?function(t){return\"[object Arguments]\"===c.call(t)}:function(t){return d(\"callee\",t)}},f=!{toString:null}.propertyIsEnumerable(\"toString\"),h=[\"constructor\",\"valueOf\",\"isPrototypeOf\",\"toString\",\"propertyIsEnumerable\",\"hasOwnProperty\",\"toLocaleString\"],g=function(){return arguments.propertyIsEnumerable(\"length\")}(),p=function(t,e){for(var n=0;n<t.length;){if(t[n]===e)return!0;n+=1}return!1};Object.keys;Number.isInteger;var m=function(t){return(t<10?\"0\":\"\")+t};Date.prototype.toISOString;function v(t){return t}var C=\"function\"==typeof Object.assign?Object.assign:function(t){if(null==t)throw new TypeError(\"Cannot convert undefined or null to object\");for(var e=Object(t),n=1,i=arguments.length;n<i;){var o=arguments[n];if(null!=o)for(var r in o)d(r,o)&&(e[r]=o[r]);n+=1}return e},k=r(function(t,e){var n={};return n[t]=e,n});Array,String,Object;var x,b,I,A,S,O,y,E,T,B,W,w,F,j,D,M,N=\"\\t\\n\\v\\f\\r   ᠎             　\\u2028\\u2029\\ufeff\";String.prototype.trim;x=window.jQuery,b=function(t,e,n){return n.replace(e,t)},w=function t(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];return n.length>=b.length?b.apply(void 0,n):function(){for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return t.apply(void 0,[].concat(n,i))}},F=function(t,e,n){var i=new RegExp(\"<\"+e,\"g\"),o=\"<\"+t,r=new RegExp(\"</\"+e,\"g\"),a=\"</\"+t,s=w(o)(i);return function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.reverse().reduce(function(t,e){return function(n){return e(t(n))}},function(t){return t})}(w(a)(r),s)(n)},j=function(t){return F(\"span\",\"div\",t)},D=[],M=\"[data-selection-bookmark]\",jQuery.fn.reverse=[].reverse,CKEDITOR.plugins.add(\"cite\",{requires:\"widget,contextmenu,wysiwygarea,dialogui,dialog,basicstyles,menu,contextmenu,floatpanel,panel\",icons:\"cite\",init:function(t){if(void 0===window.jQuery)return console.warn(\"jQuery required but undetected so quitting cite.\"),!1;CKEDITOR.dtd.$editable.span=1,(I=t).addContentsCss(this.path+\"styles/plugin.css\"),this.initWidgets(),this.setupEditorEventHandlers()},initWidgets:function(){this.registerWidgets(),this.addWidgetCommandsButtonsAndDialogs()},registerWidgets:function(){I.widgets.add(\"footnotes\",{requiredContent:\"section(footnotes)\",upcast:function(t){return\"section\"===t.name&&t.hasClass(\"footnotes\")},editables:this.retrieveFootnotesWidgetEditableElements(x(\"<div>\"+I.element.$.textContent+\"</div>\")),draggable:!1}),I.widgets.add(\"footnotemarker\",{requiredContent:\"span[data-citation]\",upcast:function(t){return t.classes.indexOf(\"sup\")>-1&&\"undefined\"!=t.attributes[\"data-footnote-id\"]},draggable:!1})},retrieveFootnotesWidgetEditableElements:function(t){var e={header:{selector:\"header > *\",allowedContent:\"span[*](*); strong em sub sup;div[*](sup)\"}},n=1,i=I.config.footnotesPrefix?\"-\"+I.config.footnotesPrefix:\"\";return t.find(\".footnotes li\").each(function(){e[\"footnote_\"+n]={selector:\"#footnote\"+i+\"-\"+x(this).attr(\"data-footnote-id\")+\" .cite\",allowedContent:\"a[href]; cite[*](*); span[*](*); strong em br i\"},n++}),e},addWidgetCommandsButtonsAndDialogs:function(){I.addCommand(\"cite\",new CKEDITOR.dialogCommand(\"citeDialog\",{allowedContent:\"section[*](*);header[*](*);li[*];a[*];cite(*)[*];sup[*];div[*](sup)\",requiredContent:\"section[*](*);header[*](*);li[*];a[*];cite(*)[*];sup[*];div[*](sup)\"})),I.addCommand(\"intext_cite\",new CKEDITOR.dialogCommand(\"intextCiteDialog\",{allowedContent:\"section[*](*);header[*](*);li[*];a[*];cite(*)[*];sup[*];div[*](sup)\",requiredContent:\"section[*](*);header[*](*);li[*];a[*];cite(*)[*];sup[*];div[*](sup)\"})),I.ui.addButton(\"Cite\",{label:\"Insert Citation\",command:\"cite\",toolbar:\"insert\"}),CKEDITOR.dialog.add(\"citeDialog\",this.path+\"dialogs/cite.js\"),CKEDITOR.dialog.add(\"intextCiteDialog\",this.path+\"dialogs/intext_cite.js\")},setupEditorEventHandlers:function(){this.retrieveContentsAndReorderMarkersOnInstanceReady(),this.moveCursorAfterFocusedWidgetOnEditorBlur(),this.reorderMarkersOnEditorChange(),this.updateMarkersWithCurrentCitationValuesOnEditorChange(),this.invokeIntextCiteDialogOnDoubleClick(),this.initMenuOnInstanceReady()},retrieveContentsAndReorderMarkersOnInstanceReady:function(){var t=this;I.on(\"instanceReady\",function(e){A=x(I.editable().$),t.reorderMarkers(\"startup\"),A=x(I.editable().$)})},moveCursorAfterFocusedWidgetOnEditorBlur:function(){I.on(\"blur\",function(){I.widgets.focused&&(x('<span class=\"dummyF\">&nbsp;</span>').insertAfter(x(I.widgets.focused.element.$).parent()),this.moveCursorAfterFocusedWidget())})},reorderMarkersOnEditorChange:function(){var t,e=this;I.on(\"change\",function(n){clearTimeout(t),t=setTimeout(function(){var t=(new Date).getTime();localStorage.getItem(\"reordering_markers\")||localStorage.setItem(\"reordering_markers\",t),n.editor.getSelection()&&n.editor.getSelection().getStartElement()&&(e.editingAFootnote(n)||(localStorage.getItem(\"reordering_markers\")==t&&setTimeout(function(){e.reorderMarkers(\"change\")},0),setTimeout(function(){localStorage.removeItem(\"reordering_markers\")},200)))},1e3)})},editingAFootnote:function(t){var e=t.editor.getSelection().getStartElement().getAscendant(\"section\");return!(!e||-1===e.$.className.indexOf(\"footnotes\"))},updateMarkersWithCurrentCitationValuesOnEditorChange:function(){var t=this;I.on(\"change\",function(e){var n=A.find(\".footnotes header h2\").html();A.find(\".footnotes li .cite\").each(function(){var e=x(this),i=x(this).parent(\"li\").attr(\"data-footnote-id\");A.find(\".sup[data-footnote-id=\"+i+\"]\").each(function(){x(this).attr(\"data-citation-modified\",t.replaceQuotesWithPlaceholder(e.html())),n&&x(this).attr(\"data-footnotes-heading\",t.replaceQuotesWithPlaceholder(n))})})})},invokeIntextCiteDialogOnDoubleClick:function(){I.on(\"doubleclick\",function(t){var e=I.getSelection().getStartElement();e.hasClass(\"cke_widget_focused\")&&e.find(\".sup[data-footnote-id]\").$.length&&I.execCommand(\"intext_cite\")})},initMenuOnInstanceReady:function(){CKEDITOR.on(\"instanceReady\",function(t){I._.menuItems.editCiteCmd||(I.addMenuGroup(\"cite\"),I.contextMenu.addListener(function(t,e){if(t.getAscendant(function(t){try{return t.hasClass(\"cke_widget_focused\")&&t.find(\".sup[data-footnote-id]\").$.length}catch(t){return null}},!0))return{editCiteCmd:CKEDITOR.TRISTATE_ON}}),I.addMenuItems({editCiteCmd:{label:\"Edit In-text Citation\",command:\"intext_cite\",group:\"cite\",order:2}}),I.removeMenuItem(\"paste\"),I.removeMenuItem(\"copy\"),I.removeMenuItem(\"cut\"))})},setCursorBookmark:function(){if(I&&A)return this.removeExistingCursorBookmark(),this.createCursorBookmarkReturnContainingElement()},removeExistingCursorBookmark:function(){A.find(M).remove(),A.find(\"span\").filter(function(){return\"&nbsp;\"===x(this).html()}).remove()},createCursorBookmarkReturnContainingElement:function(){var t=I.getSelection(),e=t.createBookmarks();return e[0]&&x(e[0].startNode.$).attr(\"data-selection-bookmark\",\"1\"),t.getRanges()[0]},isValidHtml:function(t){return!0},updateCitationsByExternalId:function(t){if(t instanceof Array){for(var e=0;e<t.length;e++)this.citationUpdateHasRequiredData(t[e])&&(this.updateFootnotesByExternalId(t[e]),this.updateInlineCitationsByExternalId(t[e]));t.length&&this.updateInlineCitationBrackets(t),this.reorderMarkers(\"build\"),I.focus()}},citationUpdateHasRequiredData:function(t){return t instanceof Object&&t.externalId&&t.externalId.length>0&&t.citation&&t.citation.length>0},updateFootnotesByExternalId:function(t){var e=this;A.find(\".footnotes li[data-footnote-id][data-ext-id=\"+t.externalId+\"]\").each(function(){var n=x(this);t.inlineCitation&&t.inlineCitation.length>0?n.attr(\"data-inline-citation\",e.removeOuterBrackets(e.replaceQuotesWithPlaceholder(j(t.inlineCitation)))):n.removeAttr(\"data-inline-citation\"),n.find(\".cite\").html(j(t.citation))})},updateInlineCitationsByExternalId:function(t){var e=this;A.find(\".sup[data-footnote-id][data-ext-id=\"+t.externalId+\"]\").each(function(){var n=x(this),i=n.find(\"a\"),o=e.replaceQuotesWithPlaceholder(j(t.citation));if(n.attr(\"data-citation\",o).attr(\"data-citation-modified\",o),i.attr(\"data-citation\",o).attr(\"data-citation-modified\",o),t.inlineCitation&&t.inlineCitation.length>0){var r=j(t.inlineCitation),a=e.removeOuterBrackets(e.replaceQuotesWithPlaceholder(r));n.attr(\"data-inline-citation\",a),i.attr(\"data-inline-citation\",a),i.html(r)}else n.removeAttr(\"data-inline-citation\"),i.removeAttr(\"data-inline-citation\"),i.html(\"X\")})},updateInlineCitationBrackets:function(t){t[0].inlineCitation.toString().length?A.find(\"[data-inline-cit-autonum]\").each(function(){var t=x(this);t.contents().each(function(){var t=x(this);t.is(\"[data-footnote-id]\")||t.is(\"[data-widget]\")||t.hasClass(\"cke_widget_wrapper\")||(3==t[0].nodeType?t[0].textContent=t[0].textContent.replace(\"[\",\"(\").replace(\"]\",\")\"):t.html(t.html().replace(\"[\",\"(\").replace(\"]\",\")\")))}),t.attr(\"data-inline-cit\",t.attr(\"data-inline-cit-autonum\")),t.removeAttr(\"data-inline-cit-autonum\")}):A.find(\"[data-inline-cit]\").each(function(){var t=x(this);t.contents().each(function(){var t=x(this);t.is(\"[data-footnote-id]\")||t.is(\"[data-widget]\")||t.hasClass(\"cke_widget_wrapper\")||(3==t[0].nodeType?t[0].textContent=t[0].textContent.replace(\"(\",\"[\").replace(\")\",\"]\"):t.html(t.html().replace(\"(\",\"[\").replace(\")\",\"]\")))}),t.attr(\"data-inline-cit-autonum\",t.attr(\"data-inline-cit\")),t.removeAttr(\"data-inline-cit\")})},getExternalIds:function(){return A.find(\".footnotes li[data-footnote-id][data-ext-id]\").map(function(){return x(this).attr(\"data-ext-id\")}).toArray()||[]},insert:function(t,e,n){this.setCursorBookmark(),I.widgets.focused&&(x('<span class=\"dummyF\">&nbsp;</span>').insertAfter(x(I.widgets.focused.element.$).parent()),this.moveCursorAfterFocusedWidget()),this.removeDataInlineCitElsThatArentMarkers(),this.moveTextOutsideBracketsOutOfDataInlineCitEls(),this.moveTextOutsideBracketsOutOfDataInlineCitAutonumEls(),this.initInlineCitationAndFootnoteData(t,e,n),this.createFootnoteIfDoesntExist(),this.generateInlineCitationHtml(),this.insertInlineCitationAndFormat(),x('<span class=\"dummyF\">&nbsp;</span>').insertAfter(A.find(\".sup[data-footnote-id]:contains(X)\").closest(\"[data-inline-cit\"+(e?\"\":\"autonum\")+\"]\")),this.reorderMarkers(\"build\"),this.moveCursorAfterFocusedWidget(),I.focus()},initInlineCitationAndFootnoteData:function(t,e,n){S=this.replaceQuotesWithPlaceholder(j(t)),T=this.findFootnote(S),O=e?this.removeOuterBrackets(this.replaceQuotesWithPlaceholder(j(e))):null,W=n,(y=this.cursorTouchingInlineCitation())||(E=this.cursorTouchingInlineCitationAutonum())},createFootnoteIfDoesntExist:function(){T||(T=this.generateFootnoteId(),I.fire(\"lockSnapshot\"),this.addFootnote(this.buildFootnote(T,S,O,W)),I.fire(\"unlockSnapshot\"))},generateInlineCitationHtml:function(){B=(O&&!y?'<span data-inline-cit=\"'+this.getNextDataInlineCitNum()+'\">':\"\")+(O||E?\"\":'<span data-inline-cit-autonum=\"'+this.getNextDataInlineCitAutonumNum()+'\">')+(O&&!y?\"(\":\"\")+(O||E?\"\":\"[\")+'<span class=\"sup\" data-citation=\"'+S+'\" data-footnote-id=\"'+T+'\" data-citation-modified=\"'+S+'\"'+(O?' data-inline-citation=\"'+O+'\"':\"\")+(W&&W.toString().length?' data-ext-id=\"'+W+'\"':\"\")+\">X</span>\"+(O&&!y?\")\":\"\")+(O||E?\"\":\"]\")+(O&&!y?\"</span>\":\"\")+(O||E?\"\":\"</span>\")},getNextDataInlineCitNum:function(){var t=0;return A.find(\"[data-inline-cit]\").each(function(){var e=parseInt(x(this).attr(\"data-inline-cit\"));t=e>t?e:t}),t+1},getNextDataInlineCitAutonumNum:function(){var t=0;return A.find(\"[data-inline-cit-autonum]\").each(function(){var e=parseInt(x(this).attr(\"data-inline-cit-autonum\"));t=e>t?e:t}),t+1},insertInlineCitationAndFormat:function(){if(y)this.insertInlineCitationWithinAdjacentGroup();else if(E)this.insertInlineCitationAutonumWithinAdjacentGroup();else{var t=this;A.find(M).each(function(){var e=x(this);return e.replaceWith(B+t.getHtmlWithoutWidgetMarkup(e[0].outerHTML)),!1}),this.moveCursorToCursorBookmark()}A.find(\".sup[data-footnote-id]\").each(function(){x(this).parent(\".cke_widget_wrapper\").length||I.widgets.initOn(new CKEDITOR.dom.element(this),\"footnotemarker\")}),this.updateInlineCitationDataAttrs()},insertInlineCitationWithinAdjacentGroup:function(){var t=[],e=!1,n=x(B),i=x(\"<div>\"+O+\"</div>\").text();A.find(\"[data-inline-cit=\"+y+\"] .sup[data-footnote-id]\").each(function(){var o=x(\"<div>\"+x(this).attr(\"data-inline-citation\")+\"</div>\").text();!e&&i&&i<o&&(t.push(n[0]),e=!0),t.push(this)}),e||t.push(n[0]),A.find(\"[data-inline-cit=\"+y+\"]\").first().html(\"(\"+t.map(function(t){return t.outerHTML}).join(\", \")+\")\")},insertInlineCitationAutonumWithinAdjacentGroup:function(){var t=[],e=x(B);A.find(\"[data-inline-cit-autonum=\"+E+\"] .sup[data-footnote-id]\").each(function(){t.push(this)}),t.push(e[0]),A.find(\"[data-inline-cit-autonum=\"+E+\"]\").first().html(\"[\"+t.map(function(t){return t.outerHTML}).join(\", \")+\"]\")},updateInlineCitationDataAttrs:function(){this.removeDuplicatedDataInlineCitAttributes(),(A=x(I.editable().$)).find(\".sup[data-footnote-id]:contains(X)\").attr(\"data-citation\",S).attr(\"data-citation-modified\",S),O&&A.find(\".sup[data-footnote-id]:contains(X)\").attr(\"data-inline-citation\",O)},removeDuplicatedDataInlineCitAttributes:function(){for(var t=1;;){var e=A.find(\"[data-inline-cit=\"+t+\"]\"),n=0;if(e.length<=0)break;e.each(function(){n>0&&x(this).removeAttr(\"data-inline-cit\"),n++}),t++}},cursorTouchingInlineCitation:function(){var t=this.cursorElementInsideCitationBlock(\"data-inline-cit\");if(!t){var e=this.getSiblingsEitherSideOfCursor(\"data-inline-cit\");(t=this.cursorElementAdjacentToCitationBlock(e))||(t=this.cursorAdjacentToCitationSeparatedByZeroSpaceText(e,\"data-inline-cit\"))}return t},cursorTouchingInlineCitationAutonum:function(){var t=this.cursorElementInsideCitationBlock(\"data-inline-cit-autonum\");if(!t){var e=this.getSiblingsEitherSideOfCursor(\"data-inline-cit-autonum\");(t=this.cursorElementAdjacentToCitationBlock(e))||(t=this.cursorAdjacentToCitationSeparatedByZeroSpaceText(e,\"data-inline-cit-autonum\"))}return t},cursorElementInsideCitationBlock:function(t){var e=null;return A.find(\"[\"+t+\"]\").each(function(){if(x(this).find(M).length)return e=x(this),!1}),e&&e.length?e.attr(t):null},getSiblingsEitherSideOfCursor:function(t){var e={},n=A.find(M);return e.nextSibling=n[0]&&x(n[0].nextSibling),e.prevSibling=n[0]&&x(n[0].previousSibling),e.nextSiblingInlineCitAttr=e.nextSibling&&e.nextSibling.attr(t),e.prevSiblingInlineCitAttr=e.prevSibling&&e.prevSibling.attr(t),e},cursorElementAdjacentToCitationBlock:function(t){return t.nextSiblingInlineCitAttr||t.prevSiblingInlineCitAttr},cursorAdjacentToCitationSeparatedByZeroSpaceText:function(t,e){for(var n=null,i=[\"nextSibling\",\"previousSibling\"],o=0;o<i.length&&!(n=this.iterateSiblingsUntilInlineCitOrNonZeroTextFound(i[o],t[i[o]]&&t[i[o]][0],e));o++);return n},iterateSiblingsUntilInlineCitOrNonZeroTextFound:function(t,e,n){for(var i=this.zeroLengthStringsRegexp(),o=null;e;){var r=x(e),a=r.attr(n);if(a){o=a;break}if(r.text().replace(i,\"\").length>0)break;e=e[t]}return o},zeroLengthStringsRegexp:function(){return new RegExp(\"[\\0\u0007\\b\u001a\u001b​-‏\\ufeff]\",\"g\")},findFootnote:function(t){if(!I.footnotesStore)return null;var e=null;for(var n in I.footnotesStore)if(I.footnotesStore.hasOwnProperty(n)&&I.footnotesStore[n]===this.replaceQuotesWithPlaceholder(t)){e=n;break}return e},buildFootnote:function(t,e,n,i){return'<li id=\"footnote'+(I.config.footnotesPrefix?\"-\"+I.config.footnotesPrefix:\"\")+\"-\"+t+'\" data-footnote-id=\"'+t+'\"'+(n?' data-inline-citation=\"'+n+'\"':\"\")+(i&&i.toString().length?' data-ext-id=\"'+i+'\"':\"\")+'><span class=\"cite\">'+this.revertQuotesPlaceholder(e)+\"</span></li>\"},addFootnote:function(t,e){var n=A.find(\".footnotes\");if(0==n.length){var i=I.config.footnotesTitle?I.config.footnotesTitle:\"References\",o=A.find(\".sup[data-footnotes-heading]\").attr(\"data-footnotes-heading\");i=this.revertQuotesPlaceholder(o||i);var r=[\"<h2>\",\"</h2>\"];I.config.footnotesHeaderEls&&(r=I.config.footnotesHeaderEls);var a='<section class=\"footnotes\"><header>'+r[0]+i+r[1]+\"</header><ol>\"+t+\"</ol></section>\";A.append(a),A.find(\"section.footnotes\").each(function(){x(this).parent(\".cke_widget_wrapper\").length||I.widgets.initOn(new CKEDITOR.dom.element(this),\"footnotes\")})}else e?n.find(\"ol\").html(t):n.find(\"ol\").append(t)},generateFootnoteId:function(){for(var t=Math.random().toString(36).substr(2,5);-1!=x.inArray(t,D);)t=String(this.generateFootnoteId());return D.push(t),t},reorderMarkers:function(t){I.fire(\"lockSnapshot\");var e=I.config.footnotesPrefix?\"-\"+I.config.footnotesPrefix:\"\",n={order:[],occurrences:{},originalCitationText:[],inlineCitation:[],modifiedCitationText:[],externalIds:[]},i=this,o=A.find(\".sup[data-footnote-id]\");if(0==o.length)return A.find(\".footnotes\").parent().remove(),void I.fire(\"unlockSnapshot\");o.each(function(){var t,o=x(this),r=o.attr(\"data-footnote-id\"),a=o.attr(\"data-citation\"),s=o.attr(\"data-citation-modified\"),u=o.attr(\"data-inline-citation\"),d=o.attr(\"data-ext-id\"),c=n.order.indexOf(r);-1==c?(n.order.push(r),n.originalCitationText.push(a),n.modifiedCitationText.push(s),n.inlineCitation.push(u),n.externalIds.push(d),c=n.order.length,n.occurrences[r]=1,t=\"1\"):(c++,n.occurrences[r]++,t=n.occurrences[r]);var l=i.generateMarkerHtml(e,a,s,c,t,r,u,d);x(this).html(l)}),I.footnotesStore={};for(var r,a,s=\"\",u=0,d=n.order.length;u<d;u++)s+=this.buildFootnote(n.order[u],n.modifiedCitationText[u],n.inlineCitation[u],n.externalIds[u]),I.footnotesStore[n.order[u]]=n.originalCitationText[u];for(u in this.addFootnote(s,!0),I.widgets.instances)if(\"footnotes\"===I.widgets.instances[u].name){r=I.widgets.instances[u];break}r&&(u=1,A.find(\".footnotes li\").each(function(){a=x(this).attr(\"data-footnote-id\"),r.initEditable(\"footnote_\"+u,{selector:\"#footnote\"+e+\"-\"+a+\" .cite\",allowedContent:\"a[href]; cite[*](*); span[*](*); em strong i\"}),u++})),I.fire(\"unlockSnapshot\")},removeDataInlineCitElsThatArentMarkers:function(){A.find(\"[data-inline-cit]\").each(function(){var t=x(this);t.find(\".sup[data-footnote-id]\").length||t.replaceWith(t.html())})},moveTextOutsideBracketsOutOfDataInlineCitEls:function(){var t=this;A.find(\"[data-inline-cit]\").each(function(){var e=x(this),n=t.cloneJqueryObject(e),i=t.getChildNodesOf(n),o=t.getChildNodesBefore1stWidgetUpToOpenBracket(i,\"(\"),r=t.joinNodesToHtmlString(o),a=t.getChildNodesAfterLastWidgetUpToCloseBracket(i,\")\"),s=t.joinNodesToHtmlString(a);t.contentExistsBefore1stWidget(r)?t.removeChildNodesBeforeOpenBracket(n,o):r=\"\",t.contentExistsAfterLastWidget(s)?t.removeChildNodesAfterCloseBracket(n,a):s=\"\",(r.length>0||s.length>0)&&e.replaceWith(r.replace(/\\([\\s\\u0000\\u0007\\u0008\\u001A\\u001B\\u007F\\u200B-\\u200F\\uFEFF]*$/g,\"\")+t.getHtmlWithoutWidgetMarkup(n[0].outerHTML)+s.replace(/^[\\s\\u0000\\u0007\\u0008\\u001A\\u001B\\u007F\\u200B-\\u200F\\uFEFF]*\\)/g,\"\"))})},getHtmlWithoutWidgetMarkup:function(t){return I.dataProcessor.toDataFormat(t,{context:\"p\"})},moveTextOutsideBracketsOutOfDataInlineCitAutonumEls:function(){var t=this;A.find(\"[data-inline-cit-autonum]\").each(function(){var e=x(this),n=t.cloneJqueryObject(e),i=t.getChildNodesOf(n),o=t.getChildNodesBefore1stWidgetUpToOpenBracket(i,\"[\"),r=t.joinNodesToHtmlString(o),a=t.getChildNodesAfterLastWidgetUpToCloseBracket(i,\"]\"),s=t.joinNodesToHtmlString(a);t.contentExistsBefore1stAutonumWidget(r)?t.removeChildNodesBeforeOpenAutonumBracket(n,o):r=\"\",t.contentExistsAfterLastAutonumWidget(s)?t.removeChildNodesAfterCloseAutonumBracket(n,a):s=\"\",(r.length>0||s.length>0)&&e.replaceWith(r.replace(/\\[[\\s\\u0000\\u0007\\u0008\\u001A\\u001B\\u007F\\u200B-\\u200F\\uFEFF]*$/g,\"\")+t.getHtmlWithoutWidgetMarkup(n[0].outerHTML)+s.replace(/^[\\s\\u0000\\u0007\\u0008\\u001A\\u001B\\u007F\\u200B-\\u200F\\uFEFF]*\\]/g,\"\"))})},cloneJqueryObject:function(t){return x(\"<div/>\").html(t[0].outerHTML).contents()},getChildNodesOf:function(t){var e=[];return t&&t.length&&t.contents().each(function(){e.push(x(this))}),e},getChildNodesBefore1stWidgetUpToOpenBracket:function(t,e){for(var n=[],i=new RegExp(\"\\\\\"+e,\"g\"),o=0;o<t.length&&!t[o].find(\"[data-widget=footnotemarker]\").length&&(n.push(t[o]),!t[o].text().match(i));o++);return n},getChildNodesAfterLastWidgetUpToCloseBracket:function(t,e){for(var n=[],i=new RegExp(\"\\\\\"+e,\"g\"),o=t.length-1;o>=0&&!t[o].find(\"[data-widget=footnotemarker]\").length&&(n.push(t[o]),!t[o].text().match(i));o--);return n.reverse()},joinNodesToHtmlString:function(t){return t.map(function(t){return 3==t[0].nodeType?t[0].data:t[0].outerHTML}).join(\"\")},contentExistsBefore1stWidget:function(t){return\"(\"!==t.trim()},contentExistsAfterLastWidget:function(t){return\")\"!==t.trim()},removeChildNodesBeforeOpenBracket:function(t,e){var n=0;t.contents().each(function(){if(++n>=e.length)return x(this).replaceWith(\"(\"),!1;x(this).remove()})},removeChildNodesAfterCloseBracket:function(t,e){var n=0;t.contents().reverse().each(function(){if(++n>=e.length)return x(this).replaceWith(\")\"),!1;x(this).remove()})},contentExistsBefore1stAutonumWidget:function(t){return\"[\"!==t.trim()},contentExistsAfterLastAutonumWidget:function(t){return\"]\"!==t.trim()},removeChildNodesBeforeOpenAutonumBracket:function(t,e){var n=0;t.contents().each(function(){if(++n>=e.length)return x(this).replaceWith(\"[\"),!1;x(this).remove()})},removeChildNodesAfterCloseAutonumBracket:function(t,e){var n=0;t.contents().reverse().each(function(){if(++n>=e.length)return x(this).replaceWith(\"]\"),!1;x(this).remove()})},generateMarkerHtml:function(t,e,n,i,o,r,a,s){return a?'<span class=\"inline-citation-before-link\"></span><span id=\"footnote-marker'+t+\"-\"+r+\"-\"+o+'\" data-citation=\"'+e+'\" data-citation-modified=\"'+n+'\" data-inline-citation=\"'+(a=this.removeOuterBrackets(a))+'\" data-footnote-id=\"'+r+'\"'+(s&&s.toString().length?' data-ext-id=\"'+s+'\"':\"\")+\">\"+this.revertQuotesPlaceholder(a)+'</span><span class=\"inline-citation-after-link\"></span>':'<span id=\"footnote-marker'+t+\"-\"+r+\"-\"+o+'\" data-citation=\"'+e+'\" data-citation-modified=\"'+n+'\" data-footnote-id=\"'+r+'\"'+(s&&s.toString().length?' data-ext-id=\"'+s+'\"':\"\")+\">\"+i+\"</span>\"},moveCursorAfterFocusedWidget:function(){var t=I.createRange(),e=I.document.find(\"span.dummyF\").getItem(0);t.setStart(e,0),t.setEnd(e,0),I.getSelection().selectRanges([t]),A.find(\"span.dummyF\").each(function(){x(this).remove()})},moveCursorToCursorBookmark:function(){var t=I.createRange(),e=I.document.find(M).getItem(0);e&&(t.setStart(e,0),t.setEnd(e,0),I.getSelection().selectRanges([t]))},replaceQuotesWithPlaceholder:function(t){return t.replace(/\"/g,\"[!quot!]\").replace(/&quot;/g,\"[!hquot!]\")},revertQuotesPlaceholder:function(t){return t.replace(/\\[!hquot!\\]/g,\"&quot;\").replace(/\\[!quot!\\]/g,'\"')},removeOuterBrackets:function(t){return t.replace(/^\\s*\\({1}\\s*/g,\"\").replace(/\\s*\\){1}\\s*$/g,\"\")}})}]);","extractedComments":[]}