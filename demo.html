<!DOCTYPE html>
<html>
  <head>
    <title>CKEditor Cite Plugin Demo</title>
  </head>
  <body>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="ckeditor/ckeditor.js"></script>
	<script src="ckeditor/samples/js/sample.js"></script>
    <link rel="stylesheet" href="ckeditor/samples/toolbarconfigurator/lib/codemirror/neo.css">
    <div>
		<h1>CKEditor Cite Plugin</h1>
		<div>
			<p>Adapted from the <a href="https://github.com/andykirk/CKEditorFootnotes" target="_blank">CKEditor Footnotes Plugin</a></p>
			<ol>
				<li>Insert CKEditor citation, can specify an <strong>In-text Citation</strong> according to Journal standards like: <i>(Johnston et al. [!a!]2009[/!a!])</i> where the <i>[!a!]</i> and <i>[/!a!]</i> are opening and closing link tags referencing the citation footnote.</li>
				<li>If the <strong>In-text Citation</strong> is left blank, the citation marker will be auto numbered eg: <i>[1]</i>.</li>
				<li><strong>Double click / right click > Edit In-text Citation</strong> to edit the in-text citation marker.</li>
				<li>Click the Toolbar <strong>Insert Citation</strong> button to insert a citation within CKEditor.</li>
			</ol>
		</div>
		<form class="insert-citation">
			<div>
				<label style="display: inline-block; width: 300px;">In-text Citation <small>(optional, auto number if blank)</small>: </label>
				<input style="width:50%;" name="inline-citation" class="inline-citation" placeholder="(Johnston et al. [!a!]2009[/!a!])" value="(Johnston et al. [!a!]2009[/!a!])">
			</div>
			<div>
				<label style="display: inline-block; width: 300px;">Citation: </label>
				<input style="width:50%;" name="citation" class="citation" 
					placeholder="Johnston, E. L., Piola, R. F., &amp;amp; Clark, G. F. (2009). The role of propagule pressure in invasion success. In &lt;i&gt;Biological invasions in marine ecosystems&lt;/i&gt; (pp. 133-151). Springer Berlin Heidelberg."
					value="Johnston, E. L., Piola, R. F., &amp;amp; Clark, G. F. (2009). The role of propagule pressure in invasion success. In &lt;i&gt;Biological invasions in marine ecosystems&lt;/i&gt; (pp. 133-151). Springer Berlin Heidelberg.">
			<div>
			<input type="submit" value="Insert Citation at Cursor">
		</form>
		<div style="color: red;" class="validation-message"></div>
	</div>
    <div id="ckeditor-container">
		<textarea class="form-control" name="doc"></textarea>
	</div>
	<script>
		;(function(){
			var editorElem = document.getElementById("ckeditor-container");
			var editor = CKEDITOR.replace("doc");
		})();
		$(document).ready(function(){
			var checkHTML = function(html) {
							  var doc = document.createElement('div');
							  doc.innerHTML = html;
							  return ( doc.innerHTML === html );
							}
			$('.validation-message').text('');
			$('form.insert-citation').on('submit', function(evt) {
				evt.preventDefault();
				$('.validation-message').text('');
				if (!checkHTML($('input[name=citation]').val()))
					$('.validation-message').text('Citation is not valid html.');
				else if (!checkHTML($('input[name=inline-citation]').val()))
					$('.validation-message').text('In-text Citation is not valid html.');
				else 
					CKEDITOR.instances.doc.plugins.cite.insertCitation(
						$('input[name=citation]').val(), 
						CKEDITOR.instances.doc, 
						$('input[name=inline-citation]').val());
			});
		});
	</script>

  </body>
</html>
